## Transparent Page Compression

- InnoDB 버퍼풀에서 디스크에 데이터를 저장할 때 압축된 상태로 저장한다.
- 반면 디스크에서 InnoDB 버퍼에 데이터를 로드할 때는 압축이 해제 된 상태로 가져온다.
  - 이후 압축이 해제된 상태의 페이지를 관리한다.
- 하나의 테이블은 동일한 크기의 페이지로 관리한다.
  - 만약 16KB 크기의 페이지를 압축한 결과 7KB가 된다면, 남은 9KB는 운영체제에 반납한다.
  - 반납 될 9KB를 펀치홀이라한다.
- 페이지 압축은 운영체제 뿐 아니라 하드웨어도 펀치홀 기능을 제공해야 실현가능하다. 따라서 잘 사용되지 않는다.

---

## Table Compression

테이블 압축은 페이지 압축에 비해 하드웨어 제약에 자유로워서 많이 사용된다.

- 반면 다음의 단점들이 있다.
  - 버퍼 풀 공간 활용 효율 저하
  - 쿼리 처리 성능 저하
  - 데이터 변경이 잦으면 압축률이 떨어진다.

### 압축 테이블 생성

- 압축을 적용하려는 테이블은 별도의 테이블 스페이스를 가지고 있어야 한다.
- 테이블을 압축하기 위해서는 `KEY_BLOCK_SIZE` (목표 페이지 크기)를 설정한다.
  - 목표 압축 페이지 크기를 달성할 때 까지 데이터를 split하고 split된 데이터를 압축하기를 반복한다. 목표 크기를 만족시킬 때 결과를 저장한다.
  - 따라서 KEY_BLOCK_SIZE를 지나치게 낮게 잡으면 split, compression이 많이 발생하여 성능 저하를 야기할 수 있다.

### 압축 페이지와 버퍼 풀

- InnoDB는 페이지의 압축, 압축 전의 2개 상태 모두를 관리한다.
- 즉, 압축을 사용하면 메모리 사용량 또한 늘어난다.
