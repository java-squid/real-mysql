- MySQLì˜ ì ê¸ˆì€ `MySQL ì—”ì§„ ë ˆë²¨ì˜ ì ê¸ˆ` / `ìŠ¤í† ë¦¬ì§€ ì—”ì§„ ë ˆë²¨ì˜ ì ê¸ˆ`
  - MySQL ì—”ì§„ ë ˆë²¨ ì ê¸ˆì€ ë‹¤ë¥¸ ìŠ¤í† ë¦¬ì§€ ì—”ì§„ ë ˆë²¨ì˜ ì ê¸ˆì— ì˜í–¥ì„ ì¤€ë‹¤.
- MySQL ì—”ì§„ ì ê¸ˆ
  - ê¸€ë¡œë²Œ ë½
  - í…Œì´ë¸” ë½
  - ë©”íƒ€ë°ì´í„° ë½
  - ë„¤ì„ë“œ ë½
- Storage Engine ì ê¸ˆ (InnoDB)
  - Record Lock
  - Gap Lock
  - Next key Lock
  - Auto increment Lock

## MySQL ì—”ì§„ ì ê¸ˆ

### Global Lock

- í•´ë‹¹ ë½ì„ ì¡ìœ¼ë©´ ë‹¤ë¥¸ ì„¸ì…˜ì—ì„œëŠ” SELECT ì™¸ì— ë‹¤ë¥¸ ì•¡ì…˜ì€ ìˆ˜í–‰ì´ ë¶ˆê°€í•˜ë‹¤.
- ì„¤ì •ì— ë”°ë¼ mysqldumpë¥¼ ì‚¬ìš©í•  ë•Œ ê±¸ë¦¬ê¸°ë„ í•˜ë¯€ë¡œ, ì‹¤í–‰ ì „ í™•ì¸ì„ ê¶Œì¥í•¨

```sql
> FLUSH TABLES WITH READ LOCK
```

### Table Lock

- í…Œì´ë¸” ë‹¨ìœ„ë¡œ ì ê¸ˆì´ ìˆ˜í–‰ë˜ëŠ” ê²ƒ
- InnoDBëŠ” DDLì˜ ê²½ìš° ì˜í–¥ì„ ë°›ì§€ë§Œ, DMLì€ ëŒ€ë¶€ë¶„ ê°€ëŠ¥

### Named Lock

- ì„ì˜ì˜ ë¬¸ìì—´ì— ì ê¸ˆì„ ì„¤ì •í•˜ëŠ” ê²ƒ
  - GET_LOCK()
- ì—¬ëŸ¬ ì„œë²„ê°„ì— ë™ê¸°í™” ë©”ì»¤ë‹ˆì¦˜ì´ í•„ìš”í•œ ê²½ìš° í™œìš©í•  ìˆ˜ ìˆë‹¤.

### Metadata Lock

- í…Œì´ë¸” êµ¬ì¡°ë¥¼ ë³€ê²½ ì‹œ íšë“í•˜ëŠ” ì ê¸ˆ
- ë¬µì‹œì  ë½ì´ë©° ëª…ì‹œì ìœ¼ë¡œ íšë“, í•´ì œëŠ” ë¶ˆê°€í•˜ë‹¤.

---

## InnoDB ìŠ¤í† ë¦¬ì§€ ì—”ì§„ ì ê¸ˆ

> [!NOTE] InnoDB Storage Engine Lock
>
> - InnoDBëŠ” ë ˆì½”ë“œ ê¸°ë°˜ì˜ ë½ ê¸°ëŠ¥ì„ ì œê³µ
> - ë ˆì½”ë“œì™€ ë ˆì½”ë“œ ì‚¬ì´ë¥¼ ì ê·¸ëŠ” Gap Lock ì œê³µ

### Record Lock

- ë ˆì½”ë“œ ìì²´ì— ì ê¸ˆì„ ì„¤ì •í•˜ëŠ” ê²ƒ
- ë°ì´í„° ì „ì²´ê°€ ì•„ë‹ˆë¼ ì¸ë±ìŠ¤ì—ë§Œ ì ê¸ˆì„ ì„¤ì •í•œë‹¤.

### Gap Lock

- ë ˆì½”ë“œì™€ ë ˆì½”ë“œ ì‚¬ì´ë¥¼ ì ê·¸ëŠ” ê²ƒ
- INSERT ê°€ ë°œìƒí–ˆì„ ë•Œ, ì €ì¥ ë  ìœ„ì¹˜ë¥¼ ì„ ì í•  ë•Œ ì‚¬ìš©
- Next key Lockì˜ ì¼ë¶€

### Next key Lock

- Record Lock + Gap Lock
- Bin logì— ê¸°ë¡ëœ ì¿¼ë¦¬ê°€ ë ˆí”Œë¦¬ì¹´, ì†ŒìŠ¤ ì„œë²„ ëª¨ë‘ ë™ì¼í•˜ê²Œ ì ìš©ë¨ì„ ë³´ì¥í•˜ê¸° ìœ„í•´ ì‚¬ìš© ë¨
  - ... ğŸ¤” (?)

### Auto increment Lock

- AUTO_INCREMENT ê°’ì„ ì¸ë±ìŠ¤ë¡œ ì‚¬ìš©í•˜ëŠ” ê²½ìš°, ì—¬ëŸ¬ ë ˆì½”ë“œê°€ INSERT ë  ë•Œ ë™ì‹œì„± ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ ì‚¬ìš©
- í…Œì´ë¸” ìˆ˜ì¤€ì˜ ì ê¸ˆ
- AUTO_INCREMENT ê°’ì„ ê°€ì ¸ì˜¬ ë•Œë§Œ ì ê¸ˆì´ ë°œìƒí•˜ë©°, ë°ì´í„° INSERT ê³¼ì •ê¹Œì§€ ì§€ì†ë˜ëŠ” ê²ƒì€ ì•„ë‹ˆë‹¤.

---

## ì¸ë±ìŠ¤ì™€ ë½ì˜ ê´€ê³„

- InnoDBì˜ ì ê¸ˆì€ ì¸ë±ìŠ¤ë¥¼ ì ê·¸ëŠ” ë°©ì‹
  - ë³€ê²½ ë  ë ˆì½”ë“œë¥¼ ì°¾ëŠ” ê³¼ì •ì—ì„œ ê²€ìƒ‰ëœ ëª¨ë“  ì¸ë±ìŠ¤ë¥¼ ì ê¸ˆ

```sql
-- CREATE TABEL employees (
--    first_name VARCHAR(30) NOT NULL,
--    last_name VARCHAR(10) NOT NULL,
--      ...
--    INDEX `idx_firstname` ON `first_name`
-- ) ENGINE = InnoDB;

> UPDATE employees SET hire_date() WHERE first_name = 'ragdoll' AND last_name = 'kim'

-- first_nameì—ë§Œ ì¸ë±ìŠ¤ê°€ ê±¸ë ¤ìˆê³ , last_nameì—ëŠ” ì¸ë±ìŠ¤ê°€ ì—†ìœ¼ë¯€ë¡œ
-- frist_name = 'ragdoll' ì„ ë§Œì¡±í•˜ëŠ” ëª¨ë“  ë ˆì½”ë“œê°€ ì ê¸´ë‹¤.
```
