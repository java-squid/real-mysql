## Lock
- MySQL에서 사용되는 잠금은 크게 스토리지 엔진 레벨과 MySQL엔진 레벨로 나눠진다.
- MySQL엔진은 MySQL 서버에서 스토리지 엔진을 제외한 나머지 부분으로 이해하면 됨.
- MySQL 엔진 레벨의 잠금은 모든 스토리지 엔진에 영향이 미치지만 스토리지 엔진 레벨의 잠금은 스토리지 엔진 간 상호 영향을 미치지는 않음.

### 1. GLOBAL LOCK
- MySQL에서 제공하는 잠금 가운데 범위가 가장 큼
- 한 세션에서 글로벌 락을 획득하면 다른 세션에서 SELECT 를 제외한 대부분의 DDL문장이나 DML문장을 실행하는 경우 글로벌 락이 해제될 때까지 해당 문장이 대기 상태로 남는다.
- 영향을 미치는 부분은 MySQL 서버 전체이고, 작업 대상이 되는 테이블이나 데이터베이스가 다르더라도 동일하게 영향을 미침.
- MyISAM, MEMORY 테이블에 대해 `mysqldump`로 일관된 백업을 받아야 할 때는 글로벌 락을 사용해야 함.
- InnoDB 스토리지 엔진은 트랜잭션을 지원하기 때문에 일관된 데이터 상태를 위해 모든 데이터 변경 상태를 멈출 필요가 없어짐. MySQL 8.0 버전 이상부터는 InnoDB가 기본 스토리지 엔진으로 채택되어 조금 더 가벼운 글로벌 락의 필요성이 생김. 따라서 8.0 이상 버전 부터는 `Xtrabackup`, `Enterprise Backup`과 같은 백업 툴의 안정적인 실행을 위해 백업 락이 도입됨
    - BACKUP LOCK
        - 일반 적인 테이블의 데이터 변경은 허용된다.
        - 특정 세션에서 백업 락을 획득하면 모든 세션에서 다음과 같이 테이블의 스키마나 사용자의 인증 관련 정보를 변경할 수 없게 된다.
            - 데이터베이스 및 테이블 등 모든 객체 생성 및 변경, 삭제
            - REPAIR TABLE과 OPTIMIZE TABLE 명령
            - 사용자 관리 및 비밀번호 변경
        
### 2. TABLE LOCK
- 개별 테이블 단위로 설정되는 잠금
- MyISAM 엔진 뿐만 아니라 InnoDB엔진을 사용하는 테이블도 동일하게 설정할 수 있음.
- 명시적, 묵시적으로 락을 획득할 수 있음
    - 명시적:  
        - 획득: `LOCK TABLES table_name [ READ | WRITE ]`  
        - 반납(해제): `UNLOCK TABLES`
    - 묵시적: MyISAM, MEMORY 테이블에 데이터를 변경하는 쿼리를 실행하면 발생한다.
        - 쿼리가 실행되는 동안 자동으로 획득했다가 쿼리가 완료된 후 자동 해제된다.
        - InnoDB 테이블의 경우 스토리지 엔진 차원에서 레코드 기반의 잠금을 제공하기 때문에 단순 데이터 변경 쿼리로 인해 묵시적인 테이블 락이 설정되지는 않는다.(대부분의 DML 쿼리에서는 무시되고 스키마 변경(DDL)의 경우에만 영향을 미친다.)

### 3. NAMED LOCK
- `GET_LOCK(name, timeout)` 함수를 이용해 임의의 문자열에 대해 잠금을 설정할 수 있다.
- 이름을 가진 잠금을 획득하고 해제할 때까지 다른 세션은 해당 잠금을 획득할 수 없다.
- 트랜잭션이 종료될 때 잠금이 자동으로 해제되지 않으므로 별도의 명령어를 사용하거나 선점시간이 종료되어 수동 해제처리를 해야함
- 분산락 구현 가능
- 데이터 소스를 분리하지 않고 사용하면 커넥션풀이 부족해지는 현상이 발생할 수 있다.
> ref
>- https://ssseung.tistory.com/539
>- https://devpoong.tistory.com/82


### 4. METADATA LOCK
- 데이터베이스의 객체(테이블, 뷰, ...)의 이름이나 구조를 변경하는 경우에 획득하는 잠금
- 명시적으로 획득하는 잠금이 아닌 데이터 베이스의 객체의 이름을 변경하는 경우 자동으로 획득하는 잠금
- RENAME TABLE의 경우 원본 이름과 변경될 이름 두 개 모두 한꺼번에 잠금을 설정함.
