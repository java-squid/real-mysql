## 고급 최적화

### Nested Loop Join

- 조인 시 드라이빙 테이블을 읽은 뒤 드리븐 테이블을 조인하는 방식

### MRR (Multi-Range Read)

- 조인이 수행될 때의 최적화 방법
- 드라이빙 테이블 한 건당 드리븐 테이블을 조인하는 것이 아니라, 조인 버퍼를 두고 조인 대상들을 버퍼링
- 조인 버퍼가 가득차면 스토리지 엔진에 데이터 읽기 요청

### Block Nested Loop

- 조인 버퍼를 사용하는 조인
- 다음의 순서로 동작한다.

```sql
SELECT *
FROM dept_emp de, employees e
WHERE de.from_date > '1995-01-01' AND emp_no < 109004;
```

    1. 드라이빙 테이블의 데이터를 읽는다.
    2. 드라이빙 테이블의 컬럼들을 조인 버퍼(메모리)에 저장한다.
    3. 드리븐 테이블을 읽는다.
    4. 조인 버퍼에 저장된 드라이빙 테이블 데이터와 드리븐 테이블 데이터를 합친다.

### 스킵 스캔

- 인덱스 순서에 의한 제약을 최적화
  - 만약 A, B, C 순서로 인덱스가 지정되어 있다면 A가 WHERE 조건에 있어야 함
  - B, C만을 활용할 수는 없는데, 이에 대한 최적화를 수행
  - A가 유니크한 소수의 값을 갖는 경우에만 효율적인 최적화가 가능해짐

### 해시 조인(hash join)

- 낮은 응답 속도, 빠른 처리량
- 네스티드 루프 조인이 부적절한 상황에서 차선으로 사용 됨
  - 조인 조건이 인덱스를 활용할 수 없는 경우
- 다음의 단계로 수행된다.
  1.  빌드 단계 : 레코드 수가 적은 테이블을 가지고 메모리에 해시 테이블 생성
  2.  프로브 단계 : 나머지 테이블을 읽어가면서 빌드 단계에서 만든 해시 테이블에서 레코드를 찾아 처리
- 해시 조인은 조인 버퍼(메모리)에 해시 테이블을 만드는데, 이 공간이 부족 할 경우 빌드 테이블, 프로브 테이블 각각을 청크 단위로 디스크에 저장하여 조인 수행
  - 빌드 테이블 청크를 하나씩 메모리에 올리고, 그와 대응되는 프로브 테이블 청크를 찾아서 조인하는 과정 반복
