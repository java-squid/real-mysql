### ***InnoDB 버퍼 풀***
- InnoDB 스토리지 엔진에서 가장 핵심적인 부분
- 디스크의 데이터 파일이나 인덱스 정보를 메모리에 캐시해두는 공간
- 쓰기 작업을 지연시켜 일괄 작업으로 처리할 수 있게 해주는 버퍼 역할도 같이 함
```일반적인 애플리케이션에서는 INSERT, UPDATE, DELETE처럼 데이터를 변경하는 쿼리는 파일의 이곳 저곳에 위치한 레코드를 변경하기 때문에 랜덤한 디스크 작업을 발생시키는데 버퍼풀이 이러한 작업을 모아서 처리하면 랜덤한 디스크 작업의 횟수를 줄일 수 있다.```
- 시스템 변수의 설정된 크기 많큼의 페이지들로 이루어져있음
  - LRU(Least Recently Used)리스트
	- 엄밀하게 LRU와 MRU(Most Recently Used) 리스트가 결한된 형태
    - 디스크로 부터 한 번 읽어온 페이지를 최대한 오랫동안 버퍼풀에 유지해서 디스크 읽기를 최소화 하기 위함.
	>데이터를 찾는 과정  
	>1. 필요로하는 페이지가 버퍼 풀에 있는지 검사  
		<ol type="A">
			<li>어댑티브 해시 인덱스를 사용해 버퍼 풀에서 페이지 검색</li>
			<li>찾으려는 레코드가 존재하는 테이블의 인덱스(B-Tree)를 이용해 버퍼 풀에서 페이지를 검색</li>
			<li></li>
		</ol>  
	>2. 디스크에서 필요한 페이지를 버퍼 풀에 적재하고, 적제된 페이지에 대한 포인터를 LRU 헤더 부분에 추가  
	>3. 버퍼 풀의 LRU 헤더 부분에 적재된 페이지가 실제로 읽히면 MRU 헤더 부분으로 이동(대량 읽기의 경우 페이지가 버퍼 풀로 적제는 되지만 실제 쿼리에서 사용되지 않을 수도 있고 해당 경우에는 MRU로 이동되지 않음)
	>4. 버퍼 풀에 존재하는 페이지는 사용자 쿼리가 얼마나 최근에 접근했었는지에 따라 나이(age)가 부여되고, 버퍼 풀에 존재하는 동안 사용되지 않면 부여된 나이가 오래되고(aging) 버퍼 풀에서 제거 된다. 페이지가 쿼리에 의해 사용되면 나이가 초기화 되어 다시 젊어지고 MRU의 헤더 부분으로 옮겨짐
		- 버퍼 풀에서 데이터 페이지를 삭제하는 작업을 `Eviction`이라고 함
		- 최근 접근 여부에 다라서 데이터 페이지는 서로 경쟁하면서 MRU/LRU로 이동하게 된다.
		- LRU의 끝으로 밀려난 페이지들은 InnoDB 엔진으로부터 버퍼 풀에서 제거된다
  - 플러시(Flush) 리스트
	- 디스크로 동기화 되지 않은 데이터를 가진 페이지(더티 페이지)의 변경 시점 기준의 페이지 목록을 관리한다.
	- 디스크에서 읽은 상태 그대로 전혀 변경이 없다면 플러시 리스트에 관리되지 않지만, 한 번 변경이 가해진 페이지는 플러시 리스트에 관리되고 특정 시점이 되면 디스크로 기록되어야 한다.
	- 데이터가 변경되면 InnoDB 엔진은 변경 내용을 리두로그에 기록하고 버푸 풀의 페이지에도 변경 내용을 반영한다.
	- InnoDB엔진은 체크포인트를 발생시켜 디스크의 리두 로그와 데이터 페이지의 상태를 동기화한다.
	- 체크포인트는 MySQL서버가 시작될 때 InnoDB 엔진이 리두로그의 어느 부분부터 복구를 실행할지 판단하는 기준점을 만드는 역할을 한다.
  - 프리(Free) 리스트
- 시스템 변수를 사용하여 현재 InnoDB 버퍼 풀의 상태를 백업하고 백업된 버퍼 풀의 상태를 다시 복구할 수 있다.
- 시스템 변수를 사용하여 현재 버퍼 풀의 메모리에 어떤 테이블의 페이지들이 적재돼 있는지 확인할 수 있다.

---
### Double Write Buffer
- InnoDB 엔진에서는 시스템 외부적인 요인으로 페이지가 일부만 기록되는 현상(Partial-Page/Torn-page)를 방지하기 위해 Double-Write 기법을 사용한다.
- 일련의 더티페이지를 디스크로 플러시할 때 실제 데이터 파일에 변경내용을 기록하기 전에 해당 페이지들을 묶어서 `DoubleWrite` 버퍼에 기록하고 InnoDB 엔진은 각 더티 페이지를 랜덤으로 쓰기를 실행함.
- InnoDB 엔진은 재시작될 때 항상 `DoubleWrite` 버퍼의 내용과 데이터 파일의 페이지들을 비교해서 다른 내용을 담고 있는 페이지가 존재하면 `DoubleWrite` 버퍼의 내용을 모두 페이지로 복사한다.

### 체인지 버퍼
- InnoDB는 디스크로부터 인덱스를 읽어와서 업데이트해야 한다면 이를 즉시 실행하지 않고 임시 공간에 저장해 두고 바로 사용자에게 결과를 반환하는 형태로 성능을 향상 시킬 수 있도록 사용하는 임시 공간
- 기본적으로 버퍼 풀로 설정된 메모리 공간의 25%까지 사용가능 하고 최대 50%까지 사용하도록 설정 가능